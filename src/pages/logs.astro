---
import BaseLayout from "../layouts/BaseLayout.astro";
import Navbar from "../components/Navbar.astro";
import Sidebar from "../components/Sidebar.astro";
import PluginComponentLoader from "../components/PluginComponentLoader.jsx";
import { getUserFromCookies } from "../lib/auth";
import { getPluginComponentForRoute } from "../lib/plugins";

const user = getUserFromCookies(Astro.cookies);
if (!user) return Astro.redirect("/login");

// Discover which plugin component is registered for the /logs route
const pageComponent = getPluginComponentForRoute("/logs");
---

<BaseLayout title="Service Logs â€“ ServerPilot">
	<Sidebar />
	<div class="flex flex-1 flex-col md:ml-64">
		<Navbar username={user.username} />

		<main class="flex-1 p-4 pb-20 md:p-6 md:pb-6">
			<div class="mb-6">
				<h1 class="text-2xl font-bold tracking-tight">Service Logs</h1>
				<p class="mt-1 text-sm text-gray-500">
					View and search systemd journal logs for Docker, Nginx, SSH,
					and other services
				</p>
			</div>

			{pageComponent ? (
				<PluginComponentLoader
					client:load
					pluginId={pageComponent.pluginId}
					componentKey={pageComponent.key}
				/>
			) : (
				<div class="glass-card rounded-2xl p-8 text-center">
					<div class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-white/5">
						<svg class="h-8 w-8 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
							<path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
							<path d="M14 2v6h6" />
							<path d="M16 13H8m8 4H8m2-8H8" />
						</svg>
					</div>
					<h3 class="text-lg font-semibold text-gray-300">Logs plugin not available</h3>
					<p class="mt-2 text-sm text-gray-500 max-w-md mx-auto">
						The Service Logs plugin is not installed or enabled.
						Visit <a href="/plugins" class="text-accent hover:underline">Plugins</a> to enable it.
					</p>
				</div>
			)}
		</main>
	</div>
</BaseLayout>
