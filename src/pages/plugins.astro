---
import BaseLayout from "../layouts/BaseLayout.astro";
import Navbar from "../components/Navbar.astro";
import Sidebar from "../components/Sidebar.astro";
import PluginManager from "../components/PluginManager.jsx";
import { getUserFromCookies } from "../lib/auth";

const user = getUserFromCookies(Astro.cookies);
if (!user) return Astro.redirect("/login");
---

<BaseLayout title="Plugins â€“ ServerPilot">
	<Sidebar />
	<div class="flex flex-1 flex-col md:ml-64">
		<Navbar username={user.username} />

		<main class="flex-1 p-4 pb-20 md:p-6 md:pb-6">
			<div class="mb-6">
				<h1 class="text-2xl font-bold tracking-tight">Plugins</h1>
				<p class="mt-1 text-sm text-gray-500">
					Extend ServerPilot with community and custom modules
				</p>
			</div>

			<!-- How to install a plugin -->
			<div
				class="glass-card rounded-2xl p-4 mb-6 border border-border-dim"
			>
				<details>
					<summary
						class="cursor-pointer text-sm font-medium text-gray-300 select-none"
					>
						How to create a plugin
					</summary>
					<div class="mt-3 text-sm text-gray-400 space-y-2">
						<p>
							1. Create a folder inside <code
								class="px-1.5 py-0.5 rounded bg-white/10 text-xs font-mono"
								>plugins/your-plugin-id/</code
							>
						</p>
						<p>
							2. Add a <code
								class="px-1.5 py-0.5 rounded bg-white/10 text-xs font-mono"
								>manifest.json</code
							> defining your plugin metadata and extension points
						</p>
						<p>
							3. (Optional) Add an <code
								class="px-1.5 py-0.5 rounded bg-white/10 text-xs font-mono"
								>index.js</code
							> with activate/deactivate lifecycle hooks and API handlers
						</p>
						<p>
							4. Restart ServerPilot to discover new plugins, then
							enable them from this page
						</p>
						<p class="mt-2">
							See the <code
								class="px-1.5 py-0.5 rounded bg-white/10 text-xs font-mono"
								>plugins/service-logs/</code
							> example plugin for reference.
						</p>
					</div>
				</details>
			</div>

			<PluginManager client:load />
		</main>
	</div>
</BaseLayout>
