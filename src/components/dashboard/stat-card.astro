---
/**
 * StatCard.astro â€“ Dashboard stat card with icon, label, value, and usage bar.
 */
interface Props {
	label: string;
	value: string;
	subtitle?: string;
	percent?: number;
	icon?: string;
	color?: string; // tailwind color like "emerald" | "blue" | "yellow" | "red"
}

const { label, value, subtitle, percent, icon, color = "blue" } = Astro.props;

const colorMap: Record<string, { bg: string; text: string; bar: string }> = {
	blue: { bg: "bg-blue-500/10", text: "text-blue-400", bar: "bg-blue-500" },
	emerald: {
		bg: "bg-emerald-500/10",
		text: "text-emerald-400",
		bar: "bg-emerald-500",
	},
	yellow: {
		bg: "bg-yellow-500/10",
		text: "text-yellow-400",
		bar: "bg-yellow-500",
	},
	red: { bg: "bg-red-500/10", text: "text-red-400", bar: "bg-red-500" },
	purple: {
		bg: "bg-purple-500/10",
		text: "text-purple-400",
		bar: "bg-purple-500",
	},
	cyan: { bg: "bg-cyan-500/10", text: "text-cyan-400", bar: "bg-cyan-500" },
};

const c = colorMap[color] ?? colorMap.blue;

function barColorDynamic(pct: number) {
	if (pct >= 90) return "bg-red-500";
	if (pct >= 70) return "bg-yellow-500";
	return c.bar;
}
---

<div class="glass-card flex flex-col gap-3">
	<div class="flex items-start justify-between">
		<div class="flex items-center gap-3">
			{
				icon && (
					<div
						class={`flex h-10 w-10 items-center justify-center rounded-xl ${c.bg}`}
					>
						<Fragment set:html={icon} />
					</div>
				)
			}
			<div>
				<p
					class="text-xs font-medium uppercase tracking-wider text-gray-400"
				>
					{label}
				</p>
				<p class="mt-0.5 text-2xl font-bold tracking-tight">{value}</p>
			</div>
		</div>
		{
			percent !== undefined && (
				<span
					class={`text-sm font-semibold ${percent >= 90 ? "text-red-400" : percent >= 70 ? "text-yellow-400" : c.text}`}
				>
					{percent.toFixed(1)}%
				</span>
			)
		}
	</div>

	{subtitle && <p class="text-xs text-gray-500">{subtitle}</p>}

	{
		percent !== undefined && (
			<div class="h-1.5 w-full overflow-hidden rounded-full bg-white/5">
				<div
					class={`h-full rounded-full transition-all duration-500 ${barColorDynamic(percent)}`}
					style={`width: ${Math.min(percent, 100)}%`}
				/>
			</div>
		)
	}
</div>
